\pagebreak
\section{The CLEAVE Framework}\label{sec:cleave}

CLEAVE (\emph{ControL bEnchmArking serVice on the Edge}) is our framework for quick, robust, and repeatable benchmarking of networked control systems.
CLEAVE tackles this challenge through a number of key design decisions that we will discuss in the following.

\begin{description}[wide]
    \item[Emulation approach.] 
    Existing benchmarking platforms for NCS either take a fully simulated approach --- running plant, network, and controller inside a completely simulated environment --- or one requiring an actual physical plant that interacts with a real network and controller.
    CLEAVE walks the line between these two approaches, employing a strategy based on having a real-time emulated representation of a Plant interact with the real network and controller.
    \item[Plant- and Controller-agnosticism.] 
    CLEAVE makes as few assumptions as possible about the inner workings of both the Plant and the Controller. 
    The only requirements for a system to be able to be emulated in CLEAVE are
    \begin{enumerate*}[itemjoin*={{ and }}]
        \item that its behavior can be described in a discrete-time fashion;
        \item that its state and the actions performed on it can be described by a finite number of scalar and/or vector variables.
    \end{enumerate*} 


    \item[API based on well-defined components.]
    The previously mentioned agnosticism is achieved through careful abstraction of the the system into an API based around the following components:
    \begin{itemize}
        \item A \texttt{State} object, which implements the discrete-time evolution of the physical system being controlled.
        This object also holds a number of named properties that can be measured or actuated upon.
        \item An arbitrary number of \texttt{Sensor} objects which measure named properties of the \texttt{State}, and potentially transform them (for instance, to add noise).
        \item A \texttt{Controller} object which receives values of named properties processed by the \texttt{Sensor} objects and returns new values for the named properties of the \texttt{State} that can be actuated upon.
        \item Finally, an arbitrary number of \texttt{Actuator} objects which receive the values generated by the \texttt{Controller} and process them before passing them on the \texttt{State}.
    \end{itemize}
    Users implement their desired behavior by extending the abstract base classes defining these components provided by the framework.

    \item[Plain Python configuration.]
    As mentioned above, users implement their desired behavior for the core components by extending classes provided by the framework.
    This is done in configuration files written in full-featured Python simply defining a number of required top-level variables and which are then passed to the main script provided with CLEAVE.
    This allows for easy configuration of arbitrarily complex emulations.
    
\end{description}

\begin{figure}
    \centering
    \includegraphics[width=3cm]{example-image-a}
    \caption{Execution flow of a time step in CLEAVE.}
\end{figure}
    
\begin{listing}
    \begin{minted}[linenos=true,
        breaklines, 
        breakafter=d,
        fontsize=\small]{Python}
from cleave.api.plant import SimpleConstantActuator, SimpleSensor
from cleave.impl.inverted_pendulum import InvPendulumState

host = 'localhost'
port = 8080

controller_class = 'InvPendulumController'

tick_rate = 100
emu_duration = '30m'

state = InvPendulumState(fail_angle_rad=-1)

sensors = [
    SimpleSensor('position', 100),
    SimpleSensor('speed', 100),
    SimpleSensor('angle', 100),
    SimpleSensor('ang_vel', 100),
]

actuators = [
    SimpleConstantActuator(initial_value=0, prop_name='force')
]

output_dir = './plant_metrics'
    \end{minted}
    \caption{Example configuration file.}
    \label{lst:config}
\end{listing}


\todo[inline]{Fill in core concepts}
\todo[inline]{Link to repo}

\subsection{General architecture}

The general architecture of CLEAVE centers around two components:

\begin{enumerate}
    \item the Plant, corresponding to the emulated physical system running on some arbitrary client device;
    \item the Controller Service running on some arbitrary cloudlet, which receives samples of the state of the Plant and produces control commands;
\end{enumerate}

These components are connected through the real network 

In the following, we will briefly discuss the design and implementation of these components.

\subsubsection{Plant}

As 

\subsubsection{Controller Service}
\subsection{Network}